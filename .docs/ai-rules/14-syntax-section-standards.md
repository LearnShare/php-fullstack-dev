# 语法/功能小节编写规范

## 概述

本文档定义了阶段二（PHP 语言特性）中语法/功能小节的详细编写规范。这些规范确保内容详实、概念清晰、前后衔接，帮助零基础学员建立完整的知识体系。

## 核心要求

### 1. 新概念的引入和解释

**要求**：
- **详细解释**：引入新概念时，必须进行详细解释，说明其作用、特点、使用场景
- **指向已有内容**：如果概念在之前章节已介绍，应指向已有内容，避免重复
- **循序渐进**：确保每个概念都有前置知识支撑，不跳跃

**示例**：

```markdown
## 概述

PHP 文件的结构和编码是编写规范代码的基础。本节详细介绍 PHP 起始标签、字符编码（UTF-8）、严格类型声明、命名空间基础等文件结构规范，帮助建立良好的代码基础。

正确的文件结构和编码设置不仅能确保代码在所有环境中正常运行，还能避免常见的编码问题和类型错误，为后续的模块化开发和代码组织打下坚实基础。
```

**指向已有内容示例**：

```markdown
- `<?php`：PHP 起始标签，表示 PHP 代码的开始（详细说明见 [2.1.2 文件结构与编码](section-02-file-structure.md)）
- `echo`：PHP 的输出语句，用于向输出流输出内容（详细说明见 [2.2 输出与调试基础](../chapter-02-output/readme.md)）
```

### 2. 内置模块/类/方法的编写规范

**要求**：
- **必须包含三个部分**：语法、参数、返回值（缺一不可）
- **提供完整示例代码**：每个函数/方法必须有可运行的示例
- **说明使用场景**：说明何时使用该函数/方法
- **注意事项**：说明使用限制、常见陷阱

**标准格式**：

```markdown
### functionName() - 函数说明

**语法**：`functionName(type $param1, type $param2 = default): returnType`

**参数**：
- `$param1`：参数说明
- `$param2`：可选，参数说明（如果是可选参数，必须标注"可选"）

**返回值**：返回值的详细说明。

**示例**：

```php
<?php
declare(strict_types=1);

$result = functionName('value', 'option');
var_dump($result); // 输出说明
```

**输出**：

```
输出内容
```

**使用场景**：
- 场景 1：说明
- 场景 2：说明

**注意事项**：
- 注意事项 1
- 注意事项 2
```

**完整示例**：

```markdown
### php_sapi_name() - 获取 SAPI 名称

**语法**：`php_sapi_name(): string`

**参数**：无参数

**返回值**：返回当前 PHP 运行环境的 SAPI（Server API）名称，类型为 `string`。常见返回值：
- `'cli'`：命令行模式
- `'cli-server'`：PHP 内置服务器
- `'fpm-fcgi'`：PHP-FPM
- `'apache2handler'`：Apache 模块
- 其他：其他 SAPI 名称

**示例**：

```php
<?php
declare(strict_types=1);

$sapi = php_sapi_name();

if ($sapi === 'cli') {
    echo "Running in CLI mode\n";
} else {
    echo "Running in Web mode: {$sapi}\n";
}
```

**输出**（CLI 模式）：

```
Running in CLI mode
```

**输出**（Web 模式）：

```
Running in Web mode: fpm-fcgi
```

**使用场景**：
- 检测当前运行环境，根据环境执行不同逻辑
- 调试和日志记录，记录运行环境信息
- 条件执行，在 CLI 和 Web 模式下执行不同代码

**注意事项**：
- 返回值是字符串，比较时应使用严格比较（`===`）
- 不同运行环境的返回值可能不同，应使用常量或配置管理
- 详细说明见 [2.1.4 文件执行方式](section-04-execution.md)
```

### 3. 前后内容的衔接和引用

**要求**：
- **引用已有内容**：提及之前章节的内容时，必须提供链接引用
- **预告后续内容**：提及后续章节的内容时，应说明"详细内容见 XX 章节"
- **避免重复**：不在当前章节重复之前章节的详细内容
- **建立知识体系**：通过引用帮助学员建立完整的知识体系

**引用格式**：

```markdown
- **指向之前章节**：`（详细说明见 [2.1.2 文件结构与编码](section-02-file-structure.md)）`
- **指向后续章节**：`（详细内容见 [2.10 函数与作用域](../chapter-10-functions/readme.md)）`
- **指向其他阶段**：`（详细说明见 [1.2.2 运行模式与验证](../../stage-01-foundation/chapter-02-runtime/section-02-execution-modes.md)）`
```

**示例**：

```markdown
## 注意事项

### 文件编码

- **必须使用 UTF-8 编码**：PHP 文件应使用 UTF-8 编码（无 BOM）
- **检查编码**：在编辑器中检查文件编码，确保是 UTF-8
- **编码问题**：如果文件编码不正确，可能导致中文字符显示乱码（详细说明见 [2.1.2 文件结构与编码](section-02-file-structure.md)）

### PHP 起始标签

- **必须使用 `<?php`**：这是 PSR-1 标准要求，确保代码在所有环境中都能正常运行
- **纯 PHP 文件不使用结束标签**：根据 PSR-1 标准，纯 PHP 文件不应使用结束标签 `?>`（详细说明见 [2.1.2 文件结构与编码](section-02-file-structure.md)）
```

## 内容详细度要求

### 基本要求

- **详细解释**：每个概念都要有充分的解释，不能简单带过
- **多个示例**：重要概念应提供多个示例，从简单到复杂
- **完整代码**：所有代码示例必须完整、可运行
- **输出说明**：每个可执行的代码示例都应包含输出说明

### 行数参考

- **基础概念**：200-300 行
- **重要概念**：300-500 行
- **复杂概念**：500-800 行

### 内容结构

每个小节应包含以下要素（根据章节类型选择）：

1. **概述**：详细说明本节内容、目标和重要性
2. **特性**：列出关键特性、优势、特点
3. **语法/定义**：详细语法说明或定义
4. **基本用法**：基本使用方法和示例
5. **完整示例**：多个完整的、可运行的示例
6. **输出结果说明**：每个示例的输出说明
7. **使用场景**：说明何时使用该功能
8. **注意事项**：使用限制、常见陷阱
9. **常见问题**：常见问题和解决方案
10. **最佳实践**：使用建议和最佳实践
11. **对比分析**：与相似功能的对比（如适用）
12. **相关章节**：指向相关章节的链接
13. **练习任务**：3-5 个练习任务

## 代码示例规范

### 代码完整性

- **必须完整**：代码示例必须完整、可运行
- **包含必要声明**：包含 `<?php`、`declare(strict_types=1);` 等必要声明
- **符合 PSR 规范**：所有代码必须符合 PSR-1 和 PSR-12 规范

### 示例组织

- **从简单到复杂**：示例应从简单开始，逐步增加复杂度
- **多个示例**：重要概念应提供多个示例
- **实际场景**：示例应贴近实际使用场景

### 输出说明

- **明确输出**：每个可执行的代码示例都应明确说明输出内容
- **解释输出**：解释输出的含义和原因
- **不同环境**：如果 CLI 和 Web 环境输出不同，应分别说明

## 引用和链接规范

### 内部引用

- **章节引用**：使用相对路径引用其他章节
- **格式统一**：使用统一的引用格式
- **链接有效**：确保所有链接指向正确的文件

### 引用格式

```markdown
- **指向当前章节其他小节**：`（详细说明见 [2.1.2 文件结构与编码](section-02-file-structure.md)）`
- **指向当前阶段其他章节**：`（详细说明见 [2.2 输出与调试基础](../chapter-02-output/readme.md)）`
- **指向其他阶段**：`（详细说明见 [1.2.2 运行模式与验证](../../stage-01-foundation/chapter-02-runtime/section-02-execution-modes.md)）`
```

## 检查清单

在编写或审查语法/功能小节时，请确认：

- [ ] 所有新概念都有详细解释或指向已有内容
- [ ] 所有函数/方法都包含语法、参数、返回值三个部分
- [ ] 所有代码示例都完整、可运行
- [ ] 所有代码示例都符合 PSR 规范
- [ ] 所有可执行的代码示例都有输出说明
- [ ] 所有引用都指向正确的章节
- [ ] 前后内容衔接自然，没有跳跃
- [ ] 避免了不必要的重复
- [ ] 建立了完整的知识体系链接

---

**最后更新**：2025-01-15  
**适用范围**：阶段二（PHP 语言特性）所有语法/功能小节
