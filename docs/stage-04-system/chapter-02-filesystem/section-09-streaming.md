# 4.2.9 流式操作与流包装器

## 概述

流（Stream）是 PHP 中统一的数据访问抽象，流包装器提供了访问不同数据源的统一接口。本节介绍 PHP 中流的概念、流包装器的使用，以及如何自定义流包装器，帮助零基础学员理解流式操作的高级应用。

**章节类型**：概念性章节

**主要内容**：
- 流的概念
- 流包装器概述
- 内置流包装器（file://、http://、php://）
- 自定义流包装器
- stream_context_create() 函数
- 流过滤器
- 完整示例

## 核心内容

### 流的概念

- 什么是流
- 流的优势
- 流与文件句柄的关系

### 流包装器

- 流包装器的概念
- 协议和包装器
- 常用内置包装器

### 内置流包装器

- file://：文件系统
- http://、https://：HTTP 协议
- php://：PHP 特殊流
- data://：数据流

### 自定义流包装器

- stream_wrapper_register() 函数
- 实现流包装器接口
- 自定义协议处理

## 基本用法

### 流包装器使用示例

```php
<?php
declare(strict_types=1);

// 使用 HTTP 流读取远程文件
$content = file_get_contents('http://example.com/file.txt');

// 使用 PHP 内存流
$handle = fopen('php://memory', 'r+');
fwrite($handle, 'Data');
rewind($handle);
$data = fread($handle, 1024);
```

## 使用场景

- 统一访问不同数据源
- 网络资源访问
- 内存数据处理
- 自定义协议实现

## 注意事项

- 流包装器的性能考虑
- 错误处理
- 流上下文的使用
- 自定义包装器的安全性

## 常见问题

- 流和文件句柄的区别？
- 如何使用 HTTP 流？
- 如何自定义流包装器？
- 流过滤器的用途？

## 最佳实践

- 使用流统一访问不同数据源
- 利用流上下文配置选项
- 自定义流包装器注意安全性
- 理解流的生命周期
