# 4.5.3 垃圾回收机制

## 概述

垃圾回收是 PHP 自动内存管理的重要机制。本节介绍 PHP 的垃圾回收机制，包括引用计数、循环引用、gc_collect_cycles() 函数等，帮助零基础学员理解 PHP 的内存管理原理。

**章节类型**：概念性章节

**主要内容**：
- 垃圾回收概述
- 引用计数机制
- 循环引用问题
- gc_collect_cycles() 函数
- 垃圾回收配置
- 完整示例

## 核心内容

### 垃圾回收概述

- 什么是垃圾回收
- 自动内存管理
- 垃圾回收的优势

### 引用计数

- 引用计数的原理
- 引用计数的增减
- 引用计数为 0 时释放

### 循环引用

- 什么是循环引用
- 循环引用的问题
- 如何避免循环引用

### gc_collect_cycles()

- 手动触发垃圾回收
- 使用场景
- 性能考虑

## 基本用法

### 垃圾回收示例

```php
<?php
declare(strict_types=1);

// 创建循环引用
$a = new stdClass();
$b = new stdClass();
$a->ref = $b;
$b->ref = $a;

// 手动触发垃圾回收
$collected = gc_collect_cycles();
echo "回收了 $collected 个循环\n";
```

## 使用场景

- 处理大量对象
- 循环引用场景
- 内存优化
- 长期运行脚本

## 注意事项

- 垃圾回收的性能开销
- 循环引用的识别
- 手动触发的时机
- 内存释放的时机

## 常见问题

- PHP 如何管理内存？
- 什么是循环引用？
- 何时需要手动触发垃圾回收？
- 如何避免内存泄漏？

## 最佳实践

- 避免不必要的循环引用
- 及时解除对象引用
- 在适当时机触发垃圾回收
- 理解自动回收机制
