# 4.9.2 结构化日志

## 概述

结构化日志便于机器解析和分析。本节介绍结构化日志的概念和实现方法，包括 JSON 格式日志、日志字段设计等，帮助零基础学员掌握结构化日志的编写。

**章节类型**：语法性章节

**主要内容**：
- 结构化日志概念
- JSON 格式日志
- 日志字段设计
- 上下文信息
- 日志库使用（Monolog、PSR-3）
- 完整示例

## 核心内容

### 结构化日志概念

- 什么是结构化日志
- 与文本日志的区别
- 结构化日志的优势

### JSON 格式日志

- JSON 格式的优势
- 字段设计原则
- 嵌套结构处理

### 日志字段设计

- 必需字段
- 可选字段
- 上下文字段
- 字段命名规范

### 日志库

- Monolog 库
- PSR-3 标准
- 日志处理器
- 格式化器

## 基本用法

### 结构化日志示例

```php
<?php
declare(strict_types=1);

// JSON 格式日志
$log = [
    'timestamp' => date('c'),
    'level' => 'INFO',
    'message' => '用户登录',
    'context' => [
        'user_id' => 123,
        'ip' => '192.168.1.1'
    ]
];
error_log(json_encode($log), 3, '/var/log/app.log');
```

## 使用场景

- 日志分析
- 日志聚合
- 监控告警
- 数据挖掘

## 注意事项

- 字段一致性
- JSON 编码问题
- 性能考虑
- 字段大小限制

## 常见问题

- 如何设计日志字段？
- JSON 日志的性能影响？
- 如何处理嵌套数据？
- 如何选择日志库？

## 最佳实践

- 使用 JSON 格式
- 设计统一的字段结构
- 使用日志库简化操作
- 包含足够的上下文信息
