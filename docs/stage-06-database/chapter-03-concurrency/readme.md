# 第 6.3 章：并发控制与 MVCC

## 章节概述

在真实的 Web 应用中，数据库几乎总是在被多个用户或进程同时访问，这就是所谓的**并发 (Concurrency)**。如果不对并发访问进行有效管理，就可能导致一系列严重的数据问题，如数据丢失、读取到脏数据等。本章将深入探讨数据库管理系统（DBMS）是如何处理并发访问的，重点介绍两种核心技术：**锁 (Locking)** 和**多版本并发控制 (MVCC - Multi-Version Concurrency Control)**。

我们将首先了解并发访问会带来哪些典型的“读”问题，例如脏读、不可重复读和幻读。然后，我们会学习 SQL 标准定义的四种事务隔离级别，以及它们是如何通过不同的机制来解决这些问题的。

本章的重点是理解 MySQL 的 InnoDB 存储引擎是如何巧妙地利用 MVCC 来实现高效的读操作（快照读），以及在需要时如何通过锁（当前读）来保证数据的一致性。我们还将学习两种主要的锁策略：悲观锁和乐观锁，并掌握它们在 PHP 应用中的实现方式。

## 学习目标

完成本章学习后，你将能够：

-   **理解并发访问带来的问题**：能够清晰地解释脏读、不可重复读和幻读。
-   **掌握事务的四种隔离级别**：了解 `READ UNCOMMITTED`, `READ COMMITTED`, `REPEATABLE READ`, `SERIALIZABLE` 的含义及区别。
-   **理解 MVCC 的核心思想**：了解 InnoDB 是如何通过多版本快照来实现高并发读性能的。
-   **区分快照读与当前读**：知道在 InnoDB 中，普通的 `SELECT` 和 `SELECT ... FOR UPDATE` 在底层机制上有何不同。
-   **掌握锁的基本概念**：理解共享锁 (Shared Lock) 和排他锁 (Exclusive Lock)。
-   **应用悲观锁和乐观锁**：能够在 PHP 代码中，根据业务场景选择并实现悲观锁或乐观锁来解决“更新丢失”等并发问题。

## 章节结构

本章分为以下几个核心小节：

-   **[6.3.1 并发问题与隔离级别](section-01-concurrency-issues-isolation.md)**：介绍并发场景下的三类数据读取问题，以及 SQL 标准定义的四种事务隔离级别。
-   **[6.3.2 MVCC 核心原理](section-02-mvcc-principles.md)**：深入讲解 InnoDB 存储引擎的 MVCC 机制，包括版本链、Read View 等核心概念。
-   **[6.3.3 锁机制：悲观锁](section-03-pessimistic-locking.md)**：学习悲观锁的思想，并掌握如何在 PDO 中使用 `SELECT ... FOR UPDATE` 来实现它。
-   **[6.3.4 锁机制：乐观锁](section-04-optimistic-locking.md)**：学习乐观锁的思想，并掌握如何通过版本号或时间戳在应用层面实现它。