# 4.5 文件上传处理

## 目标

- 理解 `multipart/form-data` 编码格式与 `$_FILES` 数据结构。
- 掌握文件上传的完整处理流程与错误处理。
- 识别常见安全风险：MIME 欺骗、文件名伪造、图片木马。
- 实现安全的文件上传策略：类型验证、大小限制、随机文件名、安全存储。

## 章节内容

本章分为三个独立小节，每节提供详细的概念解释、代码示例和最佳实践：

1. **[文件上传基础](section-01-upload-basics.md)**：`multipart/form-data` 格式、`$_FILES` 数据结构、单文件/多文件上传、规范化处理、错误处理及完整示例。

2. **[文件验证与安全](section-02-validation-security.md)**：MIME 类型验证、文件扩展名验证、文件大小限制、图片验证（防止图片木马）、文件名安全处理、安全最佳实践及完整示例。

3. **[文件存储策略](section-03-storage-strategy.md)**：存储目录设计、文件命名策略、权限设置、图片处理（缩略图）、文件清理、CDN 集成及完整示例。

## 核心概念

- **multipart/form-data**：文件上传的编码格式
- **$_FILES**：PHP 文件上传超全局变量
- **安全验证**：服务器端验证，不信任客户端数据
- **安全存储**：防止执行、防止目录遍历

## 学习建议

1. **重点掌握**：
   - `$_FILES` 数据结构的处理
   - 文件类型验证的方法
   - 安全存储的策略

2. **实践练习**：
   - 完成每小节后的练习题目
   - 实现完整的文件上传系统
   - 处理图片上传和缩略图生成

## 完成本章后

- 能够安全地处理各种文件上传场景。
- 理解文件上传的安全风险，能够实施有效的防护措施。
- 掌握文件验证和存储的最佳实践。
- 具备构建生产级文件上传系统的能力。

## 相关章节

- **4.3.3 $_FILES 与安全处理**：超全局变量中的文件处理基础
- **阶段六：安全、性能与可观测性**：安全最佳实践
