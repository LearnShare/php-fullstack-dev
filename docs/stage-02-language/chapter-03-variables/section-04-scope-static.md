# 2.3.4 全局与静态

## 目标

- 理解全局变量和静态变量的作用域和生命周期。
- 掌握 `global` 关键字和 `$GLOBALS` 的使用。
- 理解静态变量的特性和使用场景。
- 了解超全局变量的简介。

## 章节内容

本章分为两个独立小节，每节提供详细的概念解释、语法说明、参数列表和完整示例：

1. **[全局变量](section-04-scope-static.md#全局变量)**：`global` 关键字、`$GLOBALS` 数组、全局变量的使用和注意事项。

2. **[静态变量](section-04-scope-static.md#静态变量)**：静态变量的定义、生命周期、使用场景、与全局变量的区别。

## 全局变量

### 概述

全局变量是在脚本顶级作用域定义的变量，可以在函数内部通过 `global` 关键字或 `$GLOBALS` 数组访问。

**章节类型**：语法性章节

**主要内容**：
- `global` 关键字的使用
- `$GLOBALS` 数组的使用
- 全局变量的作用域
- 全局变量的注意事项
- 避免使用全局变量的原因

### 语法/定义

**global 关键字**：
- 语法：`global $variable_name;`
- 作用：在函数内部访问全局变量

**$GLOBALS 数组**：
- 语法：`$GLOBALS['variable_name']`
- 作用：直接访问全局变量

### 基本用法

```php
<?php
declare(strict_types=1);

$global_var = "Global";

function test1(): void
{
    global $global_var;
    echo $global_var . "\n";
}

function test2(): void
{
    echo $GLOBALS['global_var'] . "\n";
}
```

### 注意事项

- **避免使用全局变量**：全局变量会导致代码耦合
- **使用参数传递**：优先使用参数传递数据
- **使用依赖注入**：使用依赖注入替代全局变量

## 静态变量

### 概述

静态变量是在函数内部定义的变量，在多次函数调用间保持值不变。

**章节类型**：语法性章节

**主要内容**：
- 静态变量的定义
- 静态变量的生命周期
- 静态变量的使用场景
- 静态变量与全局变量的区别

### 语法/定义

**语法**：`static $variable_name = initial_value;`
**特点**：只在第一次调用时初始化，后续调用保持值

### 基本用法

```php
<?php
declare(strict_types=1);

function counter(): int
{
    static $count = 0;
    $count++;
    return $count;
}

echo counter() . "\n";  // 1
echo counter() . "\n";  // 2
echo counter() . "\n";  // 3
```

### 使用场景

- **计数器**：函数调用次数统计
- **缓存**：函数内部缓存
- **单例模式**：实现单例模式

### 注意事项

- **初始化**：静态变量只在第一次调用时初始化
- **作用域**：静态变量只在函数内部可见
- **线程安全**：静态变量在多线程环境下可能有问题

## 超全局变量简介

**超全局变量**：PHP 预定义的全局变量，在任何作用域都可以访问。

**常见超全局变量**：
- `$_GET`、`$_POST`、`$_REQUEST`：HTTP 请求数据
- `$_SERVER`：服务器信息
- `$_SESSION`、`$_COOKIE`：会话和 Cookie
- `$_FILES`：文件上传

**详细内容**：将在阶段五（Web/API 开发）中详细介绍。

## 总结

- 全局变量应尽量避免使用
- 静态变量适合函数内部状态保持
- 超全局变量是 PHP 预定义的全局变量
- 优先使用参数传递和依赖注入

## 相关章节

- **2.3.1 变量基础**：了解变量的基本概念
- **2.10 函数与作用域**：深入学习函数和作用域
- **阶段五：Web/API 开发**：学习超全局变量
