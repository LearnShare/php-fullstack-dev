# 2.5.1 隐式转换

## 概述

PHP 是弱类型语言，会自动进行类型转换（类型杂耍）。本节介绍类型杂耍的概念、字符串与数字转换、布尔上下文转换、比较运算中的隐式转换、常见陷阱及注意事项，帮助理解 PHP 的类型转换机制。

**章节类型**：概念性章节

**主要内容**：
- 类型杂耍的概念
- 字符串与数字的转换规则
- 布尔上下文的转换规则
- 比较运算中的隐式转换
- 常见陷阱和注意事项
- 避免隐式转换的方法

## 核心内容

### 类型杂耍

**概念**：PHP 根据上下文自动转换变量类型
**特点**：灵活但可能导致意外结果
**原则**：根据操作符和上下文自动转换

### 字符串与数字转换

**规则**：
- 字符串转数字：从字符串开头解析数字，遇到非数字字符停止
- 数字转字符串：直接转换为字符串表示

### 布尔上下文转换

**规则**：
- `false`：空值、0、空字符串、空数组
- `true`：其他所有值

### 比较运算中的隐式转换

**规则**：
- 宽松比较（`==`）：会进行类型转换
- 严格比较（`===`）：不进行类型转换

## 基本用法

### 字符串与数字转换示例

```php
<?php
declare(strict_types=1);

$str = "123";
$num = $str + 1;  // 124，字符串自动转换为数字

$num = 42;
$str = $num . " is the answer";  // "42 is the answer"
```

### 布尔上下文转换示例

```php
<?php
declare(strict_types=1);

if ("0") {  // false，字符串 "0" 转换为 false
    echo "True\n";
}

if (0) {  // false
    echo "True\n";
}
```

### 比较运算示例

```php
<?php
declare(strict_types=1);

"123" == 123;   // true，宽松比较
"123" === 123;  // false，严格比较
```

## 使用场景

- **数值计算**：字符串自动转换为数字进行计算
- **条件判断**：值自动转换为布尔值
- **字符串拼接**：数字自动转换为字符串

## 注意事项

- **精度问题**：浮点数转换可能丢失精度
- **意外转换**：隐式转换可能导致意外结果
- **性能影响**：类型转换有性能开销
- **可读性**：隐式转换降低代码可读性

## 常见问题

### 问题 1：字符串 "0" 被转换为 false
- **原因**：布尔上下文转换规则
- **解决**：使用严格比较或显式转换

### 问题 2：科学计数法比较陷阱
- **原因**：字符串转数字的规则
- **解决**：使用严格比较

## 最佳实践

- 使用严格比较（`===`）避免隐式转换
- 启用严格类型（`declare(strict_types=1)`）
- 显式转换类型，提高代码可读性
- 理解类型转换规则，避免陷阱
