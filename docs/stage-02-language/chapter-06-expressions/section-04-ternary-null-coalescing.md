# 2.6.4 三元运算符与空合并运算符

## 概述

三元运算符和空合并运算符是简化条件赋值的常用方法。本节介绍三元运算符（`?:`）、省略中间值语法、空合并运算符（`??`）、空合并赋值运算符（`??=`）的用法及优先级。

**章节类型**：语法性章节

**主要内容**：
- 三元运算符（`?:`）的语法和用法
- 省略中间值语法（`?:`）
- 空合并运算符（`??`）的语法和用法
- 空合并赋值运算符（`??=`）的语法和用法
- 运算符优先级
- 使用场景和最佳实践

## 特性

- **简洁性**：简化条件赋值代码
- **可读性**：提高代码可读性
- **安全性**：空合并运算符避免未定义变量错误

## 语法/定义

### 三元运算符

**完整语法**：`condition ? value_if_true : value_if_false`
**省略中间值**：`value ?: default`（当 value 为 truthy 时返回 value，否则返回 default）

### 空合并运算符

**语法**：`$a ?? $b`
**功能**：如果 `$a` 存在且不为 `null`，返回 `$a`，否则返回 `$b`

### 空合并赋值运算符

**语法**：`$a ??= $b`
**功能**：如果 `$a` 为 `null`，将 `$b` 赋值给 `$a`
**要求**：PHP 7.4+

## 基本用法

### 三元运算符示例

```php
<?php
declare(strict_types=1);

$age = 18;
$status = $age >= 18 ? "Adult" : "Minor";

// 省略中间值
$name = $userName ?: "Guest";
```

### 空合并运算符示例

```php
<?php
declare(strict_types=1);

$name = $userName ?? "Guest";
$value = $config['key'] ?? "default";
```

### 空合并赋值运算符示例

```php
<?php
declare(strict_types=1);

$name ??= "Guest";  // 如果 $name 为 null，赋值为 "Guest"
```

### 链式使用示例

```php
<?php
declare(strict_types=1);

$value = $a ?? $b ?? $c ?? "default";
```

## 使用场景

- **默认值**：为变量提供默认值
- **条件赋值**：根据条件赋值
- **配置读取**：读取配置值，提供默认值

## 注意事项

- **优先级**：空合并运算符优先级较低
- **null 检查**：空合并运算符只检查 `null`，不检查其他 falsy 值
- **可读性**：嵌套使用可能降低可读性

## 常见问题

### 问题 1：三元运算符嵌套
- **原因**：多层嵌套降低可读性
- **解决**：使用 `if-else` 或提取为函数

### 问题 2：空合并运算符误用
- **原因**：不理解只检查 `null` 的特性
- **解决**：理解空合并运算符的检查规则

## 最佳实践

- 使用空合并运算符提供默认值
- 避免过度嵌套三元运算符
- 理解运算符优先级
- 优先考虑代码可读性
