# 5.6.2 文件验证与安全

## 概述

文件验证和安全处理是文件上传的关键环节。本节介绍文件验证的方法和安全处理策略，包括文件类型验证、内容验证、恶意文件防护等，帮助零基础学员掌握安全的文件上传处理。

**章节类型**：最佳实践章节

**主要内容**：
- 文件验证概述
- 文件类型验证（MIME 类型、扩展名）
- 文件大小验证
- 文件内容验证
- 安全文件名生成
- 恶意文件防护
- 完整示例

## 核心内容

### 文件类型验证

- MIME 类型检查
- 文件扩展名验证
- finfo_file() 函数
- 白名单验证

### 文件内容验证

- 文件头验证
- 图片文件验证
- 文档文件验证
- 二进制文件检查

### 安全文件名

- 文件名清理
- 随机文件名生成
- 扩展名保留
- 路径安全

### 恶意文件防护

- 可执行文件检测
- 脚本文件检测
- 文件内容扫描
- 存储隔离

## 基本用法

### 文件验证示例

```php
<?php
declare(strict_types=1);

function validateUploadedFile(array $file): bool {
    // 检查 MIME 类型
    $allowedTypes = ['image/jpeg', 'image/png'];
    $finfo = finfo_open(FILEINFO_MIME_TYPE);
    $mimeType = finfo_file($finfo, $file['tmp_name']);
    
    if (!in_array($mimeType, $allowedTypes)) {
        return false;
    }
    
    // 检查文件大小
    if ($file['size'] > 5 * 1024 * 1024) {
        return false;
    }
    
    return true;
}
```

## 使用场景

- 所有文件上传功能
- 安全敏感应用
- 用户生成内容
- 文件管理系统

## 注意事项

- 多重验证
- 不要信任客户端信息
- 文件内容验证
- 存储路径安全

## 常见问题

- 如何验证文件类型？
- 如何防止恶意文件上传？
- 如何生成安全文件名？
- 如何验证文件内容？

## 最佳实践

- 使用白名单验证
- 验证文件内容而不仅是扩展名
- 生成随机文件名
- 隔离上传文件存储
