# 5.11.2 请求签名与验证

## 概述

请求签名用于验证请求的完整性和真实性。本节介绍请求签名的概念、签名算法、签名生成和验证方法，帮助零基础学员掌握请求签名技术。

**章节类型**：实践性章节

**主要内容**：
- 请求签名概念
- 签名算法（HMAC-SHA256）
- 签名生成
- 签名验证
- 时间戳验证
- 重放攻击防护
- 完整示例

## 核心内容

### 请求签名概念

- 什么是请求签名
- 签名的作用
- 签名算法选择

### 签名生成

- 请求数据排序
- 签名字符串构建
- HMAC 签名
- 签名添加

### 签名验证

- 签名提取
- 签名重新计算
- 签名比较
- 验证失败处理

### 安全考虑

- 密钥管理
- 时间戳验证
- 重放攻击防护
- 签名算法选择

## 基本用法

### 请求签名示例

```php
<?php
declare(strict_types=1);

// 生成签名
$data = ['key' => 'value', 'timestamp' => time()];
ksort($data);
$string = http_build_query($data);
$signature = hash_hmac('sha256', $string, $secretKey);

// 验证签名
$receivedSignature = $_SERVER['HTTP_X_SIGNATURE'] ?? '';
$isValid = hash_equals($signature, $receivedSignature);
```

## 使用场景

- API 安全
- 支付接口
- 第三方集成
- 敏感操作

## 注意事项

- 密钥安全
- 时间戳验证
- 签名算法
- 重放攻击

## 常见问题

- 如何生成请求签名？
- 如何验证签名？
- 如何防止重放攻击？
- 签名算法的选择？

## 最佳实践

- 使用 HMAC 算法
- 验证时间戳
- 安全存储密钥
- 实现重放攻击防护
