# 9.1.1 需求分析与功能规划

## 一、项目背景

### 1.1 项目概述

多用户博客系统是一个现代化的博客平台，旨在为用户提供一个功能完整、性能优异、安全可靠的博客写作和分享平台。系统支持多用户注册，每个用户发布和管理自己的文章，与其他用户互动，构建自己的知识社区。

### 1.2 项目目标

1. **为用户提供优质的写作体验**
   - 简洁易用的编辑器
   - 实时保存草稿
   - 丰富的格式支持（Markdown）

2. **构建活跃的内容社区**
   - 文章评论和互动
   - 用户关注和推荐
   - 内容分类和搜索

3. **确保系统性能和可靠性**
   - 快速响应时间（< 200ms）
   - 高并发支持（1000+ QPS）
   - 99.9% 可用性

4. **保障内容安全**
   - 内容审核机制
   - 敏感词过滤
   - 用户行为监控

## 二、用户角色与权限

### 2.1 用户角色

系统定义以下用户角色：

| 角色 | 说明 | 权限级别 |
|------|------|----------|
| **游客（Guest）** | 未登录用户 | 最低 |
| **普通用户（User）** | 已注册用户 | 基础 |
| **VIP 用户（VIP）** | 付费用户 | 高级 |
| **管理员（Admin）** | 系统管理员 | 最高 |

### 2.2 权限矩阵

| 功能           | 游客 | 普通用户 | VIP 用户 | 管理员 |
| :------------- | :--- | :------- | :------- | :----- |
| 浏览公开文章   | 是   | 是       | 是       | 是     |
| 注册账号       | 是   | -        | -        | -      |
| 登录系统       | 是   | 是       | 是       | 是     |
| 发布文章       | 否   | 是       | 是       | 是     |
| 编辑自己的文章 | 否   | 是       | 是       | 是     |
| 删除自己的文章 | 否   | 是       | 是       | 是     |
| 评论文章       | 否   | 是       | 是       | 是     |
| 点赞/收藏      | 否   | 是       | 是       | 是     |
| 关注用户       | 否   | 是       | 是       | 是     |
| 上传图片       | 否   | 是（限制）| 是（更多）| 是（无限制）|
| 文章置顶       | 否   | 否       | 是       | 是     |
| 审核内容       | 否   | 否       | 否       | 是     |
| 管理用户       | 否   | 否       | 否       | 是     |
| 系统配置       | 否   | 否       | 否       | 是     |

## 三、功能需求

### 3.1 用户管理模块

#### 3.1.1 用户注册

**功能描述**：新用户可以通过邮箱或用户名注册账号

**详细需求**：

1. **注册方式**
   - 邮箱注册（必须验证邮箱）
   - 用户名注册（可选）
   - 支持第三方登录（GitHub、Google，可选）

2. **注册信息**
   - 用户名：3-20 个字符，字母、数字、下划线，唯一
   - 邮箱：有效邮箱格式，唯一
   - 密码：8-32 个字符，包含字母和数字
   - 昵称：1-50 个字符，可选
   - 头像：支持上传或使用默认头像

3. **验证流程**
   - 邮箱验证：发送验证邮件，24 小时内有效
   - 未验证邮箱的用户限制部分功能
   - 支持重新发送验证邮件

4. **安全要求**
   - 密码加密存储（bcrypt）
   - 防止重复注册（邮箱、用户名唯一性检查）
   - 注册频率限制（同一 IP 每小时最多 5 次）
   - 验证码验证（可选，防止机器人）

**用户故事**：
- 作为新用户，我希望能够快速注册账号，以便开始使用博客平台
- 作为新用户，我希望注册过程简单，不需要填写过多信息

#### 3.1.2 用户登录

**功能描述**：已注册用户可以通过用户名/邮箱和密码登录

**详细需求**：

1. **登录方式**
   - 用户名/邮箱 + 密码
   - 记住我（7 天免登录）
   - 第三方登录（GitHub、Google，可选）

2. **安全机制**
   - 登录失败 5 次后锁定账号 30 分钟
   - 支持验证码（登录失败 3 次后显示）
   - 异地登录提醒（可选）
   - 登录日志记录

3. **会话管理**
   - JWT Token 认证（API）
   - Session 认证（Web）
   - Token 刷新机制
   - 多设备登录支持

**用户故事**：
- 作为用户，我希望能够安全快速地登录系统
- 作为用户，我希望能够记住登录状态，避免频繁输入密码

#### 3.1.3 用户资料管理

**功能描述**：用户可以查看和编辑自己的个人资料

**详细需求**：

1. **可编辑信息**
   - 昵称：1-50 个字符
   - 个人简介：最多 500 个字符
   - 头像：支持上传（最大 2MB，JPG/PNG）
   - 个人网站：URL 格式验证
   - 社交媒体链接（可选）

2. **统计信息**（只读）
   - 文章总数
   - 获得点赞数
   - 获得评论数
   - 关注者数量
   - 关注数量
   - 注册时间
   - 最后登录时间

3. **隐私设置**
   - 个人资料可见性（公开/仅关注者/私密）
   - 文章列表可见性
   - 是否允许被搜索

**用户故事**：
- 作为用户，我希望能够编辑个人资料，展示我的个人信息
- 作为用户，我希望能够控制我的隐私信息可见性

#### 3.1.4 密码管理

**功能描述**：用户可以修改密码和重置密码

**详细需求**：

1. **修改密码**
   - 需要验证当前密码
   - 新密码不能与当前密码相同
   - 密码强度验证

2. **重置密码**
   - 通过邮箱发送重置链接
   - 重置链接 1 小时内有效
   - 重置后原密码失效
   - 支持重新发送重置邮件

**用户故事**：
- 作为用户，我希望能够安全地修改密码
- 作为忘记密码的用户，我希望能够通过邮箱重置密码

### 3.2 文章管理模块

#### 3.2.1 文章发布

**功能描述**：用户可以创建和发布文章

**详细需求**：

1. **文章基本信息**
   - 标题：1-200 个字符，必填
   - 摘要：最多 500 个字符，可选（不填则自动生成）
   - 正文：支持 Markdown 格式，必填
   - 封面图片：支持上传或使用默认图片
   - 分类：选择一个分类，必填
   - 标签：最多 10 个标签，可选
   - 是否公开：公开/私密/仅关注者

2. **编辑器功能**
   - Markdown 编辑器（支持实时预览）
   - 图片上传（拖拽或点击上传）
   - 代码高亮
   - 表格支持
   - 数学公式支持（LaTeX，可选）

3. **草稿功能**
   - 自动保存草稿（每 30 秒）
   - 手动保存草稿
   - 草稿列表管理
   - 从草稿继续编辑

4. **发布流程**
   - 内容审核（敏感词检查）
   - 发布前预览
   - 发布后生成友好 URL（slug）
   - 发布通知（可选）

5. **限制**
   - 普通用户：每天最多发布 10 篇文章
   - VIP 用户：每天最多发布 50 篇文章
   - 文章长度限制：正文最多 100,000 个字符

**用户故事**：
- 作为作者，我希望能够方便地发布文章，支持 Markdown 格式
- 作为作者，我希望能够保存草稿，避免内容丢失
- 作为作者，我希望能够控制文章的可见性

#### 3.2.2 文章编辑

**功能描述**：用户可以编辑自己发布的文章

**详细需求**：

1. **编辑权限**
   - 只能编辑自己的文章
   - 已发布的文章可以编辑
   - 编辑后保留历史版本（可选）

2. **编辑功能**
   - 修改标题、摘要、正文
   - 修改分类和标签
   - 修改封面图片
   - 修改可见性设置

3. **版本管理**（可选）
   - 保存编辑历史
   - 查看历史版本
   - 恢复到历史版本

**用户故事**：
- 作为作者，我希望能够编辑已发布的文章，修正错误或更新内容

#### 3.2.3 文章删除

**功能描述**：用户可以删除自己发布的文章

**详细需求**：

1. **删除权限**
   - 只能删除自己的文章
   - 管理员可以删除任何文章

2. **删除方式**
   - 软删除：文章标记为已删除，但数据保留（可恢复）
   - 硬删除：彻底删除文章（需确认）

3. **删除影响**
   - 删除后文章不再显示
   - 关联的评论保留（标记为已删除文章）
   - 关联的点赞、收藏数据保留

**用户故事**：
- 作为作者，我希望能够删除不需要的文章
- 作为作者，我希望删除操作有确认提示，避免误删

#### 3.2.4 文章列表与搜索

**功能描述**：用户可以浏览和搜索文章

**详细需求**：

1. **文章列表**
   - 首页：最新发布的公开文章
   - 分类列表：按分类筛选
   - 标签列表：按标签筛选
   - 用户文章列表：查看特定用户的文章
   - 我的文章：查看自己发布的文章（包括草稿）

2. **列表功能**
   - 分页显示（每页 20 篇）
   - 排序方式：最新、最热、最多评论
   - 筛选：按分类、标签、时间范围
   - 搜索：标题、内容全文搜索

3. **搜索功能**
   - 关键词搜索（标题、内容）
   - 高级搜索：分类、标签、作者、时间范围
   - 搜索结果高亮显示
   - 搜索历史记录（可选）

4. **性能要求**
   - 列表加载时间 < 200ms
   - 搜索响应时间 < 500ms
   - 支持缓存（Redis）

**用户故事**：
- 作为读者，我希望能够方便地浏览和搜索感兴趣的文章
- 作为读者，我希望能够按分类和标签筛选文章

### 3.3 评论系统模块

#### 3.3.1 发表评论

**功能描述**：用户可以评论文章

**详细需求**：

1. **评论内容**
   - 评论正文：最多 2000 个字符
   - 支持 Markdown 格式
   - 支持 @ 提及其他用户
   - 支持表情符号

2. **评论类型**
   - 一级评论：直接评论文章
   - 二级评论：回复其他评论（嵌套评论，最多 3 层）

3. **评论审核**
   - 敏感词过滤
   - 自动审核或人工审核（可选）
   - 审核通过后显示

4. **评论限制**
   - 同一文章 1 分钟内最多评论 3 次
   - 防止刷屏

**用户故事**：
- 作为读者，我希望能够评论文章，表达我的观点
- 作为读者，我希望能够回复其他用户的评论

#### 3.3.2 评论管理

**功能描述**：用户可以管理自己的评论

**详细需求**：

1. **编辑评论**
   - 只能编辑自己的评论
   - 编辑后显示"已编辑"标记
   - 编辑时间限制（发布后 24 小时内）

2. **删除评论**
   - 只能删除自己的评论
   - 管理员可以删除任何评论
   - 删除后显示"评论已删除"

3. **评论列表**
   - 我的评论列表
   - 文章下的评论列表
   - 回复我的评论列表

**用户故事**：
- 作为用户，我希望能够编辑或删除我的评论

### 3.4 互动功能模块

#### 3.4.1 点赞与收藏

**功能描述**：用户可以点赞和收藏文章

**详细需求**：

1. **点赞功能**
   - 点赞/取消点赞
   - 显示点赞数量
   - 显示点赞用户列表（可选）
   - 防止重复点赞

2. **收藏功能**
   - 收藏/取消收藏
   - 收藏夹管理（分类收藏）
   - 显示收藏数量
   - 我的收藏列表

3. **统计**
   - 文章总点赞数
   - 文章总收藏数
   - 用户总获得点赞数

**用户故事**：
- 作为读者，我希望能够点赞和收藏喜欢的文章
- 作为读者，我希望能够管理我的收藏夹

#### 3.4.2 用户关注

**功能描述**：用户可以关注其他用户

**详细需求**：

1. **关注功能**
   - 关注/取消关注
   - 显示关注数量
   - 显示粉丝数量
   - 互相关注（好友关系）

2. **关注列表**
   - 我的关注列表
   - 我的粉丝列表
   - 互相关注列表

3. **推荐功能**
   - 推荐关注（基于兴趣、标签）
   - 可能认识的人

**用户故事**：
- 作为用户，我希望能够关注我感兴趣的作者
- 作为用户，我希望能够看到我关注的人的最新文章

#### 3.4.3 通知系统

**功能描述**：系统向用户发送各种通知

**详细需求**：

1. **通知类型**
   - 评论通知：有人评论我的文章
   - 回复通知：有人回复我的评论
   - 点赞通知：有人点赞我的文章
   - 关注通知：有人关注我
   - 系统通知：系统公告、审核结果等

2. **通知方式**
   - 站内通知（实时）
   - 邮件通知（可选）
   - 推送通知（可选）

3. **通知管理**
   - 通知列表（未读/已读）
   - 标记为已读
   - 全部标记为已读
   - 删除通知

**用户故事**：
- 作为用户，我希望能够及时收到与我相关的通知
- 作为用户，我希望能够管理我的通知

### 3.5 内容管理模块

#### 3.5.1 分类管理

**功能描述**：系统管理员可以管理文章分类

**详细需求**：

1. **分类信息**
   - 分类名称：1-50 个字符，唯一
   - 分类描述：最多 500 个字符
   - 分类图标：支持上传
   - 排序顺序：数字，越小越靠前

2. **分类层级**
   - 支持一级分类
   - 支持二级分类（可选）
   - 最多 2 层

3. **分类操作**
   - 创建分类
   - 编辑分类
   - 删除分类（需检查是否有文章使用）
   - 分类排序

**用户故事**：
- 作为管理员，我希望能够管理文章分类，方便内容组织

#### 3.5.2 标签管理

**功能描述**：用户可以创建和使用标签

**详细需求**：

1. **标签信息**
   - 标签名称：1-20 个字符
   - 标签描述：最多 200 个字符（可选）
   - 标签颜色：自定义颜色（可选）

2. **标签操作**
   - 创建标签（自动创建或手动创建）
   - 编辑标签（管理员）
   - 删除标签（管理员，需检查使用情况）
   - 合并标签（管理员）

3. **标签统计**
   - 标签使用次数
   - 热门标签列表
   - 标签云展示

**用户故事**：
- 作为用户，我希望能够使用标签来组织我的文章
- 作为管理员，我希望能够管理标签，避免重复和无效标签

### 3.6 管理后台模块

#### 3.6.1 用户管理

**功能描述**：管理员可以管理用户

**详细需求**：

1. **用户列表**
   - 用户搜索和筛选
   - 用户信息查看
   - 用户状态管理（正常/禁用/删除）

2. **用户操作**
   - 禁用用户（禁止登录）
   - 删除用户（软删除）
   - 重置用户密码
   - 修改用户角色

**用户故事**：
- 作为管理员，我希望能够管理用户，处理违规行为

#### 3.6.2 内容审核

**功能描述**：管理员可以审核用户发布的内容

**详细需求**：

1. **审核对象**
   - 待审核文章
   - 待审核评论
   - 用户举报内容

2. **审核操作**
   - 通过审核
   - 拒绝审核（需填写原因）
   - 删除内容
   - 标记为敏感内容

3. **审核流程**
   - 自动审核（敏感词检测）
   - 人工审核（管理员）
   - 审核记录

**用户故事**：
- 作为管理员，我希望能够审核用户内容，确保内容质量

#### 3.6.3 数据统计

**功能描述**：管理员可以查看系统统计数据

**详细需求**：

1. **用户统计**
   - 用户总数
   - 新增用户数（日/周/月）
   - 活跃用户数
   - 用户分布（地区、注册时间）

2. **内容统计**
   - 文章总数
   - 新增文章数（日/周/月）
   - 评论总数
   - 热门文章排行

3. **系统统计**
   - 访问量（PV/UV）
   - 响应时间
   - 错误率
   - 服务器资源使用

**用户故事**：
- 作为管理员，我希望能够查看系统统计数据，了解系统运行情况

## 四、非功能需求

### 4.1 性能需求

1. **响应时间**
   - 页面加载时间 < 2 秒
   - API 响应时间 < 200ms（95% 请求）
   - 搜索响应时间 < 500ms

2. **并发能力**
   - 支持 1000+ QPS
   - 支持 10,000+ 并发用户

3. **数据处理**
   - 支持百万级文章数据
   - 支持千万级评论数据
   - 数据库查询优化

### 4.2 安全需求

1. **认证授权**
   - 密码加密存储（bcrypt）
   - JWT Token 认证
   - 防止暴力破解（登录限制）

2. **数据安全**
   - SQL 注入防护（PDO 预处理）
   - XSS 防护（内容过滤）
   - CSRF 防护（Token 验证）

3. **内容安全**
   - 敏感词过滤
   - 内容审核机制
   - 用户行为监控

### 4.3 可用性需求

1. **系统可用性**
   - 99.9% 可用性（年停机时间 < 8.76 小时）
   - 故障自动恢复
   - 数据备份和恢复

2. **用户体验**
   - 界面简洁易用
   - 响应式设计（支持移动端）
   - 友好的错误提示

### 4.4 可维护性需求

1. **代码质量**
   - 遵循 PSR 编码规范
   - 代码注释完整
   - 单元测试覆盖率 > 80%

2. **文档**
   - API 文档完整
   - 代码文档清晰
   - 部署文档详细

### 4.5 可扩展性需求

1. **架构设计**
   - 模块化设计
   - 支持水平扩展
   - 支持微服务拆分（未来）

2. **数据扩展**
   - 数据库分表分库支持
   - 缓存扩展支持
   - 消息队列扩展支持

## 五、业务规则

### 5.1 内容规则

1. **文章规则**
   - 标题不能为空，不能超过 200 个字符
   - 正文不能为空，不能超过 100,000 个字符
   - 必须选择一个分类
   - 标签数量不能超过 10 个

2. **评论规则**
   - 评论不能为空，不能超过 2000 个字符
   - 不能重复评论相同内容
   - 评论需要审核（可选）

3. **内容审核规则**
   - 包含敏感词的内容需要审核
   - 新用户发布的内容需要审核（可选）
   - 被举报的内容需要审核

### 5.2 用户规则

1. **注册规则**
   - 用户名和邮箱必须唯一
   - 邮箱必须验证
   - 注册频率限制

2. **行为规则**
   - 发布频率限制（防止刷屏）
   - 评论频率限制
   - 操作频率限制（Rate Limiting）

### 5.3 权限规则

1. **内容权限**
   - 只能编辑/删除自己的内容
   - 管理员可以管理所有内容
   - 私密内容只有作者可见

2. **操作权限**
   - 未登录用户只能浏览公开内容
   - 普通用户不能进行管理操作
   - VIP 用户享有更多权限

## 六、用户故事总结

### 6.1 核心用户故事

1. **作为新用户**，我希望能够快速注册账号，以便开始使用博客平台
2. **作为用户**，我希望能够发布文章，分享我的知识和经验
3. **作为读者**，我希望能够浏览和搜索感兴趣的文章
4. **作为用户**，我希望能够评论文章，与其他用户互动
5. **作为用户**，我希望能够关注我感兴趣的作者
6. **作为管理员**，我希望能够管理用户和内容，确保平台质量

### 6.2 优先级划分

**P0（必须实现）**：
- 用户注册、登录
- 文章发布、编辑、删除
- 文章列表、搜索
- 评论功能
- 基础管理后台

**P1（重要功能）**：
- 用户关注
- 点赞、收藏
- 通知系统
- 内容审核

**P2（可选功能）**：
- 第三方登录
- 文章版本管理
- 高级搜索
- 数据统计

## 七、功能规划

### 7.1 第一阶段（MVP）

**目标**：实现核心功能，满足基本使用需求

**功能范围**：
- 用户注册、登录、资料管理
- 文章发布、编辑、删除、列表
- 基础评论功能
- 分类和标签管理
- 基础管理后台

**时间估算**：4-6 周

### 7.2 第二阶段（增强功能）

**目标**：增加互动功能，提升用户体验

**功能范围**：
- 用户关注
- 点赞、收藏
- 通知系统
- 文章搜索优化
- 内容审核

**时间估算**：2-3 周

### 7.3 第三阶段（高级功能）

**目标**：性能优化和高级功能

**功能范围**：
- 性能优化（缓存、查询优化）
- SEO 优化
- 数据统计
- 第三方登录
- 移动端适配

**时间估算**：2-3 周

## 八、下一步

完成需求分析后，继续学习：
- [技术架构设计](section-02-architecture.md)：设计系统架构和技术方案
